// firebase.js configuration must be imported separately
// Make sure this is loaded before app.js runs

document.addEventListener('DOMContentLoaded', () => {
  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();

  const appContainer = document.getElementById('app');
  const tabs = document.querySelectorAll('[data-tab]');
  const tabContents = document.querySelectorAll('.tab');
  const themeSwitcher = document.getElementById('themeSwitcher');
  const panicBtn = document.getElementById('panicBtn');
  const loadingOverlay = document.getElementById('init-overlay');

  // Remove loading overlay
  window.addEventListener('load', () => {
    loadingOverlay.style.display = 'none';
  });

  // Tab Switching
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const target = tab.getAttribute('data-tab');
      tabContents.forEach(c => c.classList.remove('active'));
      document.getElementById(target).classList.add('active');
    });
  });

  // Theme Switcher
  if (themeSwitcher) {
    themeSwitcher.addEventListener('change', (e) => {
      const selectedTheme = e.target.value;
      document.body.classList.remove('light-theme', 'dark-theme');
      document.body.classList.add(`${selectedTheme}-theme`);
      localStorage.setItem('theme', selectedTheme);
    });

    // Load persisted theme
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.body.classList.add(`${savedTheme}-theme`);
    themeSwitcher.value = savedTheme;
  }

  // Panic Button
  if (panicBtn) {
    panicBtn.addEventListener('click', () => {
      if (confirm("Are you sure you want to clear all data and logout?")) {
        localStorage.clear();
        sessionStorage.clear();
        if (auth.currentUser) {
          auth.signOut().then(() => {
            location.reload();
          });
        } else {
          location.reload();
        }
      }
    });
  }

  // Check auth state
  auth.onAuthStateChanged(user => {
    if (user) {
      console.log("User signed in:", user.email);
      loadUserProfile(user);
    } else {
      console.log("No user signed in.");
      // Optional: Show login UI or redirect
    }
  });

  // Load user profile (example for future feature usage)
  function loadUserProfile(user) {
    db.collection('users').doc(user.uid).get().then(doc => {
      if (doc.exists) {
        const data = doc.data();
        document.getElementById('userDisplayName').textContent = data.displayName || user.email;
        if (data.theme) {
          document.body.classList.add(`${data.theme}-theme`);
          themeSwitcher.value = data.theme;
        }
      }
    });
  }

  // OPTIONAL: Additional initialization code goes here
});
